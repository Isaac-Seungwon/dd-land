<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.dd.test.worldcup.attraction.mapper.WorldCupAttractionMapper">

	<!--
        어트랙션 리스트의 전체 개수를 조회하는 쿼리입니다.
        - tblAWC와 vwAttractionList 테이블을 조인하여 전체 어트랙션 개수를 가져옵니다.
        - 결과 타입은 int입니다.
	-->
	<select id="getTotalCount" resultType="int">
		select count(*)
	    from tblAWC awc
	    join vwAttractionList al
	    	ON awc.attraction_seq = al.attraction_seq
	</select>
   
	<!--
		모든 어트랙션을 조회하는 쿼리입니다.
		- close 파라미터로 어트랙션의 오픈 여부를 전달받습니다.
        - vwAttractionList와 tblAWC를 조인하여 테스트 여부가 'Y'인 어트랙션 정보만 가져오며,
          페이징을 위해 rownum을 사용합니다.
        - 결과 타입은 AttractionDTO 리스트입니다.
    -->
	<select id="getAllAttraction" parameterType="map" resultType="com.project.dd.activity.attraction.domain.AttractionDTO">
	    select * from (
		    select n.*, rownum as rnum
		    from (
		        SELECT al.*, awc.is_test
		        FROM tblAWC awc
		        JOIN vwAttractionList al ON awc.attraction_seq = al.attraction_seq
		    ) n
		) where rnum between #{startIndex} and #{endIndex}
	</select>
	
	<!--
        운영 중인 어트랙션을 조회하는 쿼리입니다.
        - close 파라미터로 어트랙션의 오픈 여부를 전달받습니다.
        - vwAttractionList와 tblAWC를 조인하여 테스트 여부가 'Y'이고 오픈 여부가
          close 파라미터와 일치하는 어트랙션 정보를 가져옵니다.
        - 결과 타입은 AttractionDTO 리스트입니다.
    -->
	<select id="getRunAttraction" parameterType="String" resultType="com.project.dd.activity.attraction.domain.AttractionDTO">
    	select
	        al.*
	    from tblAWC awc
	    join vwAttractionList al
	    	on awc.attraction_seq = al.attraction_seq
	    where al.close = #{close} and awc.is_test = 'Y'
	</select>
	
	<!--
        모든 어트랙션 월드컵 정보를 조회하는 쿼리입니다.
        - isTest 파라미터로 테스트 여부를 전달받습니다.
        - 결과 타입은 WorldCupAttractionDTO 리스트입니다.
    -->
	<select id="getAllAWC" parameterType="String" resultType="com.project.dd.test.worldcup.attraction.domain.WorldCupAttractionDTO">
		select * from tblAWC where is_test = #{isTest}
	</select>
	
	<!--
        모든 어트랙션 월드컵 승리 정보를 조회하는 쿼리입니다.
        - 결과 타입은 WorldCupAttractionWinDTO 리스트입니다.
    -->
	<select id="getAllAWCWin" resultType="com.project.dd.test.worldcup.attraction.domain.WorldCupAttractionWinDTO">
		select * from tblAWCWin
	</select>
	
	<!--
        모든 어트랙션 월드컵 최종 승리 정보를 조회하는 쿼리입니다.
        - 결과 타입은 WorldCupAttractionFinalWinDTO 리스트입니다.
    -->
	<select id="getAllAWCFinalWin" resultType="com.project.dd.test.worldcup.attraction.domain.WorldCupAttractionFinalWinDTO">
		select * from tblAWCFinalWin
	</select>
	
	<!--
        어트랙션 상태를 업데이트하는 쿼리입니다.
        - map으로 isTest와 attractionSeq를 전달받아 업데이트합니다.
    -->
	<update id="updateAttractionStatus" parameterType="map">
	    update tblAWC
	    set is_test = #{isTest}
	    where attraction_seq = #{attractionSeq}
	</update>
	
</mapper>